---
title: "Practical Tools HW1"
author: "Group Sarndal: Stacey Frank & Chendi Zhao"
date: "1/24/2022"
output: html_document
---
```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(PracTools)
library(tidyverse)
library(knitr)
```
##1.
```{r}
p_U=c(0.71,0.52,0.07)

a=ceiling(nProp(CV0=0.1,pU=p_U))

b=ceiling(nProp(V0=(0.03)^2,pU=p_U))

c=ceiling(nPropMoe(moe.sw=1,e=0.03,alpha=0.05,pU=p_U))
```

```{r, results='hide'}
sampsize<-cbind.data.frame(a,b,c)
rownames(sampsize) <- c('71%','52%','7%')
sampsize
```
1a) For each of these proportions, the size of a simple random sample needed to achieve a CV of 10% is 41, 92, and 1329.

1b) For each of these proportions, the size of a simple random sample needed to achieve a standard error of 3% points is 229, 278, and 73.

1c) For each of these proportions, the size of a simple random sample needed to achieve an MOE of 3% points, assuming an alpha of .05, are 879, 1066, and 278.

1d)

```{r}
round(1.96*sqrt((1-p_U)*p_U/sampsize[1:3,]),digits = 5)
```

1e) 
In a), as $n=\frac{\frac{q_U}{p_U}}{CV_0^2}$, the sample size will be larger for rare characteristics than for more prevalent ones given a fixed $CV_0$.
In b), as $n=\frac{p_U*q_U}{V_0}$, the sample size will be larger when $p_U*q_U$ is maximized when $p_U$ is close to 50% given a fixed $V_0$.
In c),as $n=s^2_\frac{1-\alpha}{2}*\frac{p_Uq_U}{e^2}$,the sample size will also be larger when $p_U*q_U$ is maximized when $p_U$ is close to 50% given a fixed $e^2$.

Therefore, the largest sample size occurs in sampling part-time workers who are enrolled in vision programs in a), and occurs in sampling full-time workers who are enrolled in medical care plans in b and c.

##2.

2a)
```{r}
p_U<-c(0.01,0.05,seq(0.1,0.9,0.1),0.95,0.99)
q_U=1-p_U
CV<-round(sqrt((q_U/p_U)/100),digits = 4)
sqrt_V<-round(sqrt((q_U*p_U)/100),digits=4)
Estimate<-cbind.data.frame(p_U,q_U,CV,sqrt_V)
Estimate
```

2b)
```{r}
ggplot(Estimate, aes(p_U)) + 
  geom_line(aes(y = CV, colour = "CV"))+geom_point(aes(y = CV, colour = "CV")) + 
  geom_line(aes(y = sqrt_V, colour = "sqrt_V"))+geom_point(aes(y = sqrt_V, colour = "sqrt_V"))+
  theme(axis.title.y=element_blank())
```




2c)
From the plot,  we observed that:
1. As $p_U$ increases, $CV$ decreases dramatically.
2. As $p_U$ increases,$\sqrt{V}$ increases to the maximum value when $p_U=0.5$ and then decreases back to 0.
These findings echo the relationships that were seen in 1e. In terms of sampling populations with a rare characteristic, $CV$ would be much larger than $\sqrt{V}$ under the same $p_U$. Therefore, setting a $\sqrt{V}$ would be better in this case.

##3

3a) What if no relative cost values are available? What are options for sample allocation across strata?

If no relative cost values are available, you can still allocate the sample using equal allocation, proportional allocation or Neyman allocation. 
Proportional allocation only requires stratum population proportions, and the Neyman allocation only requires stratum population proportions and stratum level population variances. 

3b) What would the results be if we had chosen a proportional allocation instead with a fixed sample size of 100? What are the potential issues?
```{r}

Nh=c(215, 65, 252, 50, 149, 144)

prop=strAlloc(n.tot=100, Nh=Nh, alloc="prop")
prop$allocation
prop$nh
prop$'nh/n'

```
The proportional allocation results in the following allocation of cases for the six strata: 25, 7, 29, 6, 17, 16. The potential issue is that very few cases are allocated to the smallest strata, for residential and military veteran MHOs. This is primarily an issue if you want to analyze data from each of the strata separately. 

3c) What would the results be if we had chosen a Neyman allocation with the same total sample size as the cost-strained (a total budget of $100,000) allocation?
```{r}
budget=100000
Sh=c(26787207, 10645109, 6909676, 11085034, 9817762, 44553355)
ch=c(1400, 200, 300, 600, 450, 1000)
cost=strAlloc(Nh=Nh, Sh=Sh, cost=budget, ch=ch, alloc="totcost")
cost$allocation
cost$nh
cost$'nh/n'
cost_n=ceiling(sum(cost$nh))
cost_n

ney=strAlloc(n.tot=cost_n, Nh=Nh, Sh=Sh, alloc="neyman")
ney$allocation
ney$nh
ney$'nh/n'

```
The cost-constrained allocation with a budget of $100,000 results in a total sample size of 119. A Neyman allocation of 119 cases results in the following number of cases allocated to each of the 6 strata: 41, 5, 12, 4, 11, 46.
