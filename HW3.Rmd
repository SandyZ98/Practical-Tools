---
title: "SURVMETH 745 HW3"
author: "Stacey Frank&Chendi Zhao"
date: "2/3/2022"
output: html_document
---

```{r setup, include=FALSE}
library(PracTools)
library(tidyverse)
library(paramtest)
```
#VDK Exercise 4.1.
Write out the null and alternative hypothesis being tested.
Calculate the sample size as instructed.
```{r}
income_02=6100
income_10=7000
delta=income_10-income_02
unitRV=2.5
sd=sqrt(unitRV*income_02^2)
power.t.test(sd=sd,
             delta=delta,
             power=0.8,
             type = "one.sample",
             alt = "one.sided",
             sig.level = 0.05)
```
##A
$H_0$:$\mu=$$7000
$H_A$:$\mu\neq$7000 or $H_A$:$\mu>$7000
at $\alpha$=0.05 level
##B
A simple random sample size of 712 will allow us to detectthat the average income that has risen to $7,000.

#VDK Exercise 4.2. 
Example 4.6 is in VDK P116
##a)
```{r}
sd_1=sqrt(200/2)
power.t.test(sd=sd_1,
             delta=5,
             power=0.8,
             type = "two.sample",
             alt = "one.sided",
             sig.level = 0.05)

power.t.test(sd=sd_1,
             delta=5,
             power=0.9,
             type = "two.sample",
             alt = "one.sided",
             sig.level = 0.05)
```
If $\sigma^2_d=200$, the sample size with 80% power would be 51 and the sample size with 90% would be 70.
##b)
```{r}
sd_2=sqrt(800/2)
power.t.test(sd=sd_2,
             delta=5,
             power=0.8,
             type = "two.sample",
             alt = "one.sided",
             sig.level = 0.05)

power.t.test(sd=sd_2,
             delta=5,
             power=0.9,
             type = "two.sample",
             alt = "one.sided",
             sig.level = 0.05)
```
If $\sigma^2_d=800$, the sample size with 80% power would be 199 and the sample size with 90% would be 275.
##c)
When having the same power, sample size will be larger as $\sigma^2_d$ increases.
When having the same $\sigma^2_d$, sample size will be large as power goes up.

## Simulation
Use the simulation approach introduced in the class with 10,000 iterations and check its results against results from an appropriate power function in R.
```{r}
t_fun_1<-function(simN,sampsize,delta){
x1<-rnorm(sampsize,sd_1)
x2<-rnorm(sampsize,delta,sd_1)
t<-t.test(x1,x2,var.equal=T)
tstat<-t$statistic
p<-t$p.value
sig<-p<0.05
return(c(t=tstat,p=p,sig=sig))
}


t_power_1<-grid_search(t_fun_1,
params=list(sampsize=c(51,70),
delta=5),
n.iter=10000,output='data.frame')

results(t_power_1)%>%
group_by(sampsize.test, delta.test)%>%
summarize(power=mean(sig))
```

```{r}
t_fun_2<-function(simN,sampsize,delta){
x1<-rnorm(sampsize,sd_2)
x2<-rnorm(sampsize,delta,sd_2)
t<-t.test(x1,x2,var.equal=T)
tstat<-t$statistic
p<-t$p.value
sig<-p<0.05
return(c(t=tstat,p=p,sig=sig))
}


t_power_2<-grid_search(t_fun_2,
params=list(sampsize=c(199,275),
delta=5),
n.iter=10000,output='data.frame')

results(t_power_2)%>%
group_by(sampsize.test, delta.test)%>%
summarize(power=mean(sig))

power.t.test(n = c(51,70,199,275), delta = 5, sd =c(sd_1,sd_1,sd_2,sd_2),
sig.level = 0.05,
type = c("two.sample"),
alternative = c("one.sided"))
```
Under the simulation approach, for sample size equals to 51,70,199,275, the powers are 0.94,0.99,1,1, which are close to one and slightly larger than the corresponding results obtained from an appropriate power function. Therefore, with the sample sizes above, it is very likely for us to detect a difference in mean weight of 5kg between males and females.
