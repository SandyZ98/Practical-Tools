---
title: "HW2_cd"
author: "Stacey & Chendi"
date: "1/27/2022"
output: html_document
---
## Packages 
```{r, echo=FALSE}
library(PracTools)
library(tidyverse)
library(janitor)
```

```{r}
See VDK P66-67 Example 3.16
#x<-c(70,160,227,235,275,300,310,378,400,461,472,474,498,562,584,635,670,712,760,816)
#y<-c(244,402,732,925,632,557,1226,896,2190,1948,1239,1258,1657,2116,1326,1606,1707,2089,1283,1239)
#sample<-cbind.data.frame(x,y)
#n=20


sample<-read.table("C:/Users/cd_zh/Desktop/745/Hospital_50.txt",header = T,sep = ",")
sample<-rename(sample,x=BEDS,y=DISCHARGE)

N=393
n=35
N_bed=107956
n_bed=sum(sample$x)
#a
p_i<-sample$x/N_bed
w_i=1/(p_i*n)
#verify
sum(w_i*sample$x)
round(w_i,digit=2)
```
#a
If the design weights are correct, the sum of number of beds in each sampled hosptital*weight should be the total number of beds in the population(107956)
```{r}
#b  
(3.31)
y_bar_bed=round(sum(sample$y/(p_i))/(N*n),2)
y_bar_bed
```
The mean of discharges based on the sample using the $\pi$-estimator is  1060.62
.

```{r}
#c
(3.41)
V_hat_1_c=n^2*sum((w_i*sample$y-mean(w_i*sample$y))^2)/(n-1)
V_hat_1_c=sum((sample$y/p_i-mean(sample$y/p_i))^2)/(n-1)
(3.32)
V_y_bar_wr=V_hat_1_c/(N^2*n)
V_y_bar_wr
```
The estimated variance of the mean of discharges is 1221.01
Observation:??? 

```{r}
#e
(3.43)
V_hat_1_e=sum(sqrt(hospital$x))*sum(((sample$y)^2/(sqrt(sample$x)*p_i)))/n-(sum(sample$y/p_i)/n)^2+V_y_bar_wr*N^2
V_hat_1_e
(3.33)
N_new=V_hat_1_e/((N*mean(hospital$y)*0.15)^2)
ceiling(N_new)
```
If we select a new sample with probabilities proportional to the square of root of beds. The appropriate $V_1$ in this case would be 2133663146 And to meet the target CV, we only need to sample 1 hospitals.









1.
ceiling(nPropMoe(moe.sw=1,e=0.005,alpha=0.05,pU=0.02))
2.
data("smho98")
y1<-smho98$EXPTOTAL
y_S1<-var(smho98$EXPTOTAL)
y_bar1<-mean(smho98$EXPTOTAL)
cv1<-y_S1/(y_bar1)^2
cv1
