---
title: "HW2"
author: "Stacey & Chendi"
date: "1/25/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Packages 
```{r, echo=FALSE}
library(PracTools)
library(tidyverse)
library(janitor)
```

## 3.
###data
```{r}
data(hospital)
sample<-read.table("C:/Users/cd_zh/Desktop/745/Hospital_50.txt",header = T,sep = ",")
```

###3(a)
```{r}
N=393
n=50
N_bed=107956
n_bed=sum(sample$BEDS)

p_i=sample$BEDS/N_bed
weights=1/(p_i*n)
#or
weights=N_bed/n/sample$BEDS
```

If the design weights are correct, the sum of number of beds in each sampled hosptital*weight should be the total number of beds in the population(107956)

```{r}
sum(weights*sample$BEDS)
round(weights,digit=2)
```

The design weights are shown above.
###3(b)
```{r}
y_bar_bed=round(sum(sample$DISCHARGE/(n*p_i))/N,2)
y_bar_bed
```

The mean of discharges based on the sample using the $\pi$-estimator is  742.43.
###3(c)
```{r}
V_hat_1_c=sum(((sample$DISCHARGE/p_i)-mean(sample$DISCHARGE/p_i))^2)/(n-1)
V_hat_1_c

V_y_bar_wr=V_hat_1_c/(N^2*n)
round(V_y_bar_wr,2)
```

The estimated variance of the mean of discharges is 593.06

Observation:???

###3(e)
```{r}
q_i=sqrt(sample$BEDS)/sum(sqrt(hospital$x))
V_hat_1_e=mean((sample$DISCHARGE)^2/(p_i*q_i))-(mean(sample$DISCHARGE/p_i))^2+V_hat_1_c
V_hat_1_e

N_new=V_hat_1_e/(N*mean(hospital$y)*0.15)^2
ceiling(N_new)
```

If we select a new sample with probabilities proportional to the square of root of beds. The appropriate $V_1$ in this case would be 42427171200. And to meet the target CV, we need to sample 19 hospitals.


